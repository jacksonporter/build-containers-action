{"version":3,"file":"standard.js","sources":["../../../src/repositories/types/standard.ts"],"sourcesContent":["import Handlebars from 'handlebars'\nimport * as core from '@actions/core'\nimport { execSync } from 'child_process'\nimport { RepositoryConfig } from '../../config.js'\n\nexport abstract class StandardRepository {\n  private repositoryConfig: RepositoryConfig\n  public readonly type: string = 'standard'\n\n  constructor(\n    repositoryConfig: RepositoryConfig,\n    templateValues: { [key: string]: string }\n  ) {\n    const configTemplateFunc = Handlebars.compile(\n      JSON.stringify(repositoryConfig)\n    )\n    const resolvedConfig = configTemplateFunc({\n      env: process.env,\n      ...templateValues\n    })\n\n    this.repositoryConfig = JSON.parse(resolvedConfig)\n  }\n\n  protected getRepositoryConfig(): RepositoryConfig {\n    return this.repositoryConfig\n  }\n\n  public async login(): Promise<void> {\n    const repositoryConfig = this.getRepositoryConfig()\n\n    if (repositoryConfig.password) {\n      core.setSecret(repositoryConfig.password)\n    }\n\n    core.info(`Logging in to ${repositoryConfig.registry}`)\n    try {\n      execSync(\n        `docker login ${repositoryConfig.registry} -u ${repositoryConfig.username} -p ${repositoryConfig.password}`,\n        {\n          stdio: 'inherit'\n        }\n      )\n    } catch (error) {\n      core.error(`Failed to login to ${repositoryConfig.registry}`)\n      throw error\n    }\n  }\n}\n\nexport default StandardRepository\n"],"names":["core.setSecret","core.info","core.error"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;MAKsB,kBAAkB,CAAA;AAC9B,IAAA,gBAAgB;IACR,IAAI,GAAW,UAAU;IAEzC,WACE,CAAA,gBAAkC,EAClC,cAAyC,EAAA;AAEzC,QAAA,MAAM,kBAAkB,GAAG,UAAU,CAAC,OAAO,CAC3C,IAAI,CAAC,SAAS,CAAC,gBAAgB,CAAC,CACjC;QACD,MAAM,cAAc,GAAG,kBAAkB,CAAC;YACxC,GAAG,EAAE,OAAO,CAAC,GAAG;AAChB,YAAA,GAAG;AACJ,SAAA,CAAC;QAEF,IAAI,CAAC,gBAAgB,GAAG,IAAI,CAAC,KAAK,CAAC,cAAc,CAAC;;IAG1C,mBAAmB,GAAA;QAC3B,OAAO,IAAI,CAAC,gBAAgB;;AAGvB,IAAA,MAAM,KAAK,GAAA;AAChB,QAAA,MAAM,gBAAgB,GAAG,IAAI,CAAC,mBAAmB,EAAE;AAEnD,QAAA,IAAI,gBAAgB,CAAC,QAAQ,EAAE;AAC7B,YAAAA,qBAAc,CAAC,gBAAgB,CAAC,QAAQ,CAAC;;QAG3CC,gBAAS,CAAC,CAAA,cAAA,EAAiB,gBAAgB,CAAC,QAAQ,CAAE,CAAA,CAAC;AACvD,QAAA,IAAI;AACF,YAAA,QAAQ,CACN,CAAA,aAAA,EAAgB,gBAAgB,CAAC,QAAQ,CAAO,IAAA,EAAA,gBAAgB,CAAC,QAAQ,CAAO,IAAA,EAAA,gBAAgB,CAAC,QAAQ,EAAE,EAC3G;AACE,gBAAA,KAAK,EAAE;AACR,aAAA,CACF;;QACD,OAAO,KAAK,EAAE;YACdC,iBAAU,CAAC,CAAA,mBAAA,EAAsB,gBAAgB,CAAC,QAAQ,CAAE,CAAA,CAAC;AAC7D,YAAA,MAAM,KAAK;;;AAGhB;;;;"}